<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Чек-лист проверки медицинской карты</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        @font-face {
            font-family: 'Inter';
            src: url('./fonts/inter-cyrillic-400-normal.woff2') format('woff2');
            font-weight: 400;
            font-style: normal;
            font-display: swap;
        }

        @font-face {
            font-family: 'Inter';
            src: url('./fonts/inter-cyrillic-500-normal.woff2') format('woff2');
            font-weight: 500;
            font-style: normal;
            font-display: swap;
        }

        @font-face {
            font-family: 'Inter';
            src: url('./fonts/inter-cyrillic-600-normal.woff2') format('woff2');
            font-weight: 600;
            font-style: normal;
            font-display: swap;
        }

        @font-face {
            font-family: 'Inter';
            src: url('./fonts/inter-cyrillic-700-normal.woff2') format('woff2');
            font-weight: 700;
            font-style: normal;
            font-display: swap;
        }
        
        :root {
            --primary-color: #2c7fb8;
            --secondary-color: #7fcdbb;
            --light-color: #f0f9ff;
            --border-color: #ddd;
            --save-btn-bg: #ffc107;
            --save-btn-hover: #e0a800;
            --export-btn-bg: #28a745;
            --export-btn-hover: #218838;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
        }
        
        body {
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
            color: #333;
            -webkit-font-smoothing: antialiased;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background-color: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid var(--primary-color);
        }
        
        h1 {
            color: var(--primary-color);
            margin-bottom: 10px;
            font-size: 1.8rem;
            font-weight: 600;
        }
        
        .info-block {
            background-color: var(--light-color);
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 20px;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        
        .info-row {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }
        
        .info-row label {
            font-weight: 600;
        }
        
        .info-row input, .info-row textarea {
            width: 100%;
            padding: 8px;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            font-size: 1rem;
            background-color: white;
            font-family: 'Inter', sans-serif;
        }
        
        .info-row textarea {
            min-height: 60px;
            resize: vertical;
        }
        
        @media (min-width: 769px) {
            .info-row-horizontal {
                display: flex;
                flex-direction: row;
                align-items: center;
                gap: 10px;
            }
            .info-row-horizontal label {
                min-width: 200px;
            }
        }
        
        .timestamp {
            background-color: var(--light-color);
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 20px;
            display: flex;
            flex-wrap: wrap;
            align-items: center;
            gap: 10px;
        }
        
        .timestamp label {
            font-weight: 600;
        }
        
        .timestamp input {
            padding: 8px;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            font-size: 1rem;
            font-family: 'Inter', sans-serif;
        }
        
        .auto-save-status {
            font-size: 0.9rem;
            color: #666;
            margin-left: 0;
        }
        
        .progress-bar {
            height: 8px;
            background-color: #e0e0e0;
            border-radius: 4px;
            margin-bottom: 20px;
            overflow: hidden;
        }
        
        .progress {
            height: 100%;
            background-color: var(--primary-color);
            width: 0%;
            transition: width 0.3s ease;
        }
        
        .sections-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(400px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .section {
            border: 1px solid var(--border-color);
            border-radius: 5px;
            overflow: hidden;
        }
        
        .section.collapsed {
            max-height: 60px;
        }
        
        .section.expanded {
            max-height: 800px;
        }
        
        .section-header {
            background-color: var(--primary-color);
            color: white;
            padding: 12px 15px;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .section-header h2 {
            margin: 0;
            font-size: 1.1rem;
            flex: 1;
            font-weight: 500;
        }
        
        .section-content {
            padding: 15px;
            max-height: 600px;
            overflow-y: auto;
            display: none;
        }
        
        .section.expanded .section-content {
            display: block;
        }
        
        .question {
            margin-bottom: 15px;
            padding: 10px;
            border-left: 3px solid var(--secondary-color);
            background-color: #f9f9f9;
            transition: background-color 0.3s;
            position: relative;
        }
        
        .question-text {
            margin-bottom: 10px;
            font-weight: 500;
            font-size: 1rem;
            padding-right: 50px;
            line-height: 1.4;
        }
        
        .check-button {
            position: absolute;
            top: 10px;
            right: 10px;
            width: 30px;
            height: 30px;
            background-color: #f0f0f0;
            border: 1px solid #ccc;
            border-radius: 4px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }
        
        .check-button.checked {
            background-color: #4CAF50;
            border-color: #4CAF50;
        }
        
        .check-button.checked::after {
            content: "✓";
            color: white;
            font-weight: bold;
            font-size: 14px;
        }
        
        .check-button.checked-red {
            background-color: #dc3545;
            border-color: #dc3545;
        }
        
        .check-button.checked-red::after {
            content: "✓";
            color: white;
            font-weight: bold;
            font-size: 14px;
        }
        
        .comment {
            margin-top: 10px;
            width: 100%;
            padding: 8px;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            resize: none;
            min-height: 60px;
            font-size: 0.95rem;
            overflow: hidden;
            transition: height 0.2s;
            font-family: 'Inter', sans-serif;
        }
        
        .section-status {
            font-size: 0.8rem;
            background-color: rgba(255,255,255,0.2);
            padding: 3px 8px;
            border-radius: 12px;
            margin-left: 10px;
            font-weight: 400;
        }
        
        .controls {
            display: flex;
            justify-content: center;
            margin-top: 30px;
            gap: 20px;
        }
        
        button {
            padding: 12px 30px;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 1.1rem;
            transition: opacity 0.3s;
            font-weight: 500;
            font-family: 'Inter', sans-serif;
        }
        
        button:hover {
            opacity: 0.9;
        }
        
        .save-btn {
            background-color: var(--save-btn-bg);
        }
        
        .save-btn:hover {
            background-color: var(--save-btn-hover);
        }
        
        .export-btn {
            background-color: var(--export-btn-bg);
        }
        
        .export-btn:hover {
            background-color: var(--export-btn-hover);
        }
        
        .clear-btn {
            background-color: #f44336;
        }
        
        .clear-btn:hover {
            background-color: #d32f2f;
        }

        .print-btn {
            background-color: #9c27b0;
        }
        
        .print-btn:hover {
            background-color: #7b1fa2;
        }

        @media print {
            body {
                background-color: white;
                padding: 5mm !important;
                margin: 0 !important;
                font-size: 10pt;
            }
            
            .container {
                box-shadow: none;
                padding: 0 !important;
                max-width: none !important;
                margin: 0 !important;
                width: 100% !important;
            }
            
            .controls, .progress-bar, .auto-save-status {
                display: none !important;
            }
            
            .section {
                max-height: none !important;
                margin-bottom: 10px !important;
                border: 1px solid #000 !important;
            }
            
            .section.collapsed {
                max-height: none !important;
            }
            
            .section-content {
                display: block !important;
                max-height: none !important;
                overflow: visible !important;
                padding: 8px !important;
            }
            
            .section-header {
                cursor: default;
                background-color: #2c7fb8 !important;
                -webkit-print-color-adjust: exact;
                print-color-adjust: exact;
                padding: 6px 8px !important;
                margin-bottom: 0 !important;
            }
            
            .section-header h2 {
                font-size: 11pt !important;
                margin: 0 !important;
            }
            
            .sections-grid {
                display: block !important;
                grid-template-columns: none !important;
                gap: 0 !important;
                margin-bottom: 0 !important;
            }
            
            .question {
                margin-bottom: 8px !important;
                padding: 6px !important;
            }
            
            .question-text {
                font-size: 9pt !important;
                margin-bottom: 5px !important;
                padding-right: 35px !important;
            }
            
            .check-button {
                width: 20px !important;
                height: 20px !important;
                top: 6px !important;
                right: 6px !important;
                -webkit-print-color-adjust: exact;
                print-color-adjust: exact;
            }
            
            .check-button.checked::after,
            .check-button.checked-red::after {
                font-size: 10px !important;
            }
            
            .comment {
                min-height: 40px !important;
                padding: 4px !important;
                font-size: 9pt !important;
                border: 1px solid #000 !important;
            }
            
            .section-status {
                display: none !important;
            }
            
            header {
                margin-bottom: 15px !important;
                padding-bottom: 10px !important;
            }
            
            h1 {
                font-size: 14pt !important;
                margin-bottom: 5px !important;
            }
            
            .info-block {
                padding: 8px !important;
                margin-bottom: 10px !important;
            }
            
            .info-row input, .info-row textarea {
                border: none !important;
                background: transparent !important;
                padding: 2px 0 !important;
            }
            
            .timestamp {
                padding: 8px !important;
                margin-bottom: 10px !important;
            }
            
            .timestamp input {
                padding: 4px !important;
                font-size: 10pt !important;
                border: 1px solid #000 !important;
                background: transparent !important;
            }
        }
        
        @media (max-width: 768px) {
            .sections-grid {
                grid-template-columns: 1fr;
            }
            
            .section-header h2 {
                font-size: 1rem;
            }
            
            .controls {
                flex-direction: column;
            }
            
            button {
                width: 100%;
            }
        }
        </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Чек-лист проверки медицинской карты</h1>
            <p class="subtitle">Форма № 025/у - амбулаторное ведение пациента</p>
            <button type="button" class="clear-btn-top" id="clearBtn">Очистить форму</button>
        </header>

        <div class="content">
            <div class="check-info">
                <div class="check-info-left">
                    <div class="info-field">
                        <label>ID/номер карты</label>
                        <input type="text" id="patientId" placeholder="Номер карты или ID">
                    </div>
                    <div class="info-field">
                        <label>Дата проверки</label>
                        <input type="date" id="checkDate">
                    </div>
                </div>
                <div class="current-date-badge" id="currentDateDisplay"></div>
            </div>

            <div class="status-message" id="statusMessage">Готов к работе • Автосохранение каждые 10 секунд</div>
            
            <div class="progress-block">
                <div class="progress-stats">
                    <span>Прогресс проверки: <span id="progressPercent">0%</span></span>
                    <span><span id="completedCount">0</span> из <span id="totalCount">67</span></span>
                </div>
                <div class="progress-bar-bg">
                    <div class="progress-fill" id="progressFill" style="width: 0%"></div>
                </div>
            </div>

            <form id="checklistForm">
                <!-- Раздел 1 -->
                <div class="section">
                    <h2>Раздел 1: Оформление титульного листа и паспортных данных</h2>
                    
                    <div class="question-block" data-id="1.1">
                        <div class="question-row">
                            <span class="question-text"><strong>1.1.</strong> В левом верхнем углу указаны название и адрес медицинской организации.</span>
                            <span class="checkbox-right">
                                <input type="checkbox" id="1.1">
                            </span>
                        </div>
                        <label class="comment-label">Комментарий:</label>
                        <textarea class="comment-area" id="comment_1.1" placeholder="Введите комментарий..."></textarea>
                    </div>
                    
                    <div class="question-block" data-id="1.2">
                        <div class="question-row">
                            <span class="question-text"><strong>1.2.</strong> Полностью (без сокращений) указаны ФИО, дата рождения пациента.</span>
                            <span class="checkbox-right">
                                <input type="checkbox" id="1.2">
                            </span>
                        </div>
                        <label class="comment-label">Комментарий:</label>
                        <textarea class="comment-area" id="comment_1.2" placeholder="Введите комментарий..."></textarea>
                    </div>
                    
                    <div class="question-block" data-id="1.3">
                        <div class="question-row">
                            <span class="question-text"><strong>1.3.</strong> В п.5 указаны адреса: постоянной и временной регистрации, фактический.</span>
                            <span class="checkbox-right">
                                <input type="checkbox" id="1.3">
                            </span>
                        </div>
                        <label class="comment-label">Комментарий:</label>
                        <textarea class="comment-area" id="comment_1.3" placeholder="Введите комментарий..."></textarea>
                    </div>
                    
                    <div class="question-block" data-id="1.4">
                        <div class="question-row">
                            <span class="question-text"><strong>1.4.</strong> Полис ОМС (номер, серия, дата выдачи, страховая компания).</span>
                            <span class="checkbox-right">
                                <input type="checkbox" id="1.4">
                            </span>
                        </div>
                        <label class="comment-label">Комментарий:</label>
                        <textarea class="comment-area" id="comment_1.4" placeholder="Введите комментарий..."></textarea>
                    </div>
                    
                    <div class="question-block" data-id="1.5">
                        <div class="question-row">
                            <span class="question-text"><strong>1.5.</strong> СНИЛС.</span>
                            <span class="checkbox-right">
                                <input type="checkbox" id="1.5">
                            </span>
                        </div>
                        <label class="comment-label">Комментарий:</label>
                        <textarea class="comment-area" id="comment_1.5" placeholder="Введите комментарий..."></textarea>
                    </div>
                    
                    <div class="question-block" data-id="1.6">
                        <div class="question-row">
                            <span class="question-text"><strong>1.6.</strong> Документ, удостоверяющий личность (сведения о дате и органе выдачи).</span>
                            <span class="checkbox-right">
                                <input type="checkbox" id="1.6">
                            </span>
                        </div>
                        <label class="comment-label">Комментарий:</label>
                        <textarea class="comment-area" id="comment_1.6" placeholder="Введите комментарий..."></textarea>
                    </div>
                    
                    <div class="question-block" data-id="1.7">
                        <div class="question-row">
                            <span class="question-text"><strong>1.7.</strong> В правом верхнем углу указаны № участка и № ФРБТ.</span>
                            <span class="checkbox-right">
                                <input type="checkbox" id="1.7">
                            </span>
                        </div>
                        <label class="comment-label">Комментарий:</label>
                        <textarea class="comment-area" id="comment_1.7" placeholder="Введите комментарий..."></textarea>
                    </div>
                    
                    <div class="question-block" data-id="1.8">
                        <div class="question-row">
                            <span class="question-text"><strong>1.8.</strong> В п.6 указан контактный телефон пациента и/или доверенного лица.</span>
                            <span class="checkbox-right">
                                <input type="checkbox" id="1.8">
                            </span>
                        </div>
                        <label class="comment-label">Комментарий:</label>
                        <textarea class="comment-area" id="comment_1.8" placeholder="Введите комментарий..."></textarea>
                    </div>
                    
                    <div class="question-block" data-id="1.9">
                        <div class="question-row">
                            <span class="question-text"><strong>1.9.</strong> Копии документов приобщаются к карте ТОЛЬКО с письменного согласия пациента. На копиях делается отметка о согласии.</span>
                            <span class="checkbox-right">
                                <input type="checkbox" id="1.9">
                            </span>
                        </div>
                        <label class="comment-label">Комментарий:</label>
                        <textarea class="comment-area" id="comment_1.9" placeholder="Введите комментарий..."></textarea>
                    </div>

                    <div class="section-comment">
                        <label class="section-comment-label">Общий комментарий к разделу 1:</label>
                        <textarea class="section-comment-area" id="section_comment_1" placeholder="Введите общий комментарий к разделу..."></textarea>
                    </div>
                </div>

                <!-- Раздел 2 -->
                <div class="section">
                    <h2>Раздел 2: Диагноз, информированные согласия, извещения</h2>
                    
                    <div class="question-block" data-id="2.1">
                        <div class="question-row">
                            <span class="question-text"><strong>2.1.</strong> В ф. 025/у указан клинический диагноз и коды по МКБ.</span>
                            <span class="checkbox-right">
                                <input type="checkbox" id="2.1">
                            </span>
                        </div>
                        <label class="comment-label">Комментарий:</label>
                        <textarea class="comment-area" id="comment_2.1" placeholder="Введите комментарий..."></textarea>
                    </div>
                    
                    <div class="question-block" data-id="2.2">
                        <div class="question-row">
                            <span class="question-text"><strong>2.2.</strong> На оборотной стороне внесены данные об аллергических и нежелательных реакциях (либо прописано в любом месте на оборотной стороны обложки).</span>
                            <span class="checkbox-right">
                                <input type="checkbox" id="2.2">
                            </span>
                        </div>
                        <label class="comment-label">Комментарий:</label>
                        <textarea class="comment-area" id="comment_2.2" placeholder="Введите комментарий..."></textarea>
                    </div>
                    
                    <div class="question-block" data-id="2.3">
                        <div class="question-row">
                            <span class="question-text"><strong>2.3.</strong> Приложен корешок извещения об установлении/прекращении диспансерного наблюдения (форма соответствует утвержденной).</span>
                            <span class="checkbox-right">
                                <input type="checkbox" id="2.3">
                            </span>
                        </div>
                        <label class="comment-label">Комментарий:</label>
                        <textarea class="comment-area" id="comment_2.3" placeholder="Введите комментарий..."></textarea>
                    </div>
                    
                    <div class="question-block" data-id="2.4">
                        <div class="question-row">
                            <span class="question-text"><strong>2.4.</strong> Приложено информированное добровольное согласие (ИДС) на мед. вмешательство (форма по Приказу №1051н).</span>
                            <span class="checkbox-right">
                                <input type="checkbox" id="2.4">
                            </span>
                        </div>
                        <label class="comment-label">Комментарий:</label>
                        <textarea class="comment-area" id="comment_2.4" placeholder="Введите комментарий..."></textarea>
                    </div>
                    
                    <div class="question-block" data-id="2.5">
                        <div class="question-row">
                            <span class="question-text"><strong>2.5.</strong> Заполнено, подписано пациентом/представителем и медработником с расшифровкой ФИО.</span>
                            <span class="checkbox-right">
                                <input type="checkbox" id="2.5">
                            </span>
                        </div>
                        <label class="comment-label">Комментарий:</label>
                        <textarea class="comment-area" id="comment_2.5" placeholder="Введите комментарий..."></textarea>
                    </div>
                    
                    <div class="question-block" data-id="2.6">
                        <div class="question-row">
                            <span class="question-text"><strong>2.6.</strong> В случае отказа — сделана запись о разъяснении последствий с указанием ФИО и должности специалиста.</span>
                            <span class="checkbox-right">
                                <input type="checkbox" id="2.6">
                            </span>
                        </div>
                        <label class="comment-label">Комментарий:</label>
                        <textarea class="comment-area" id="comment_2.6" placeholder="Введите комментарий..."></textarea>
                    </div>
                    
                    <div class="question-block" data-id="2.7">
                        <div class="question-row">
                            <span class="question-text"><strong>2.7.</strong> Приложено ИДС на обработку персональных данных (форма по Распоряжению №144-Р).</span>
                            <span class="checkbox-right">
                                <input type="checkbox" id="2.7">
                            </span>
                        </div>
                        <label class="comment-label">Комментарий:</label>
                        <textarea class="comment-area" id="comment_2.7" placeholder="Введите комментарий..."></textarea>
                    </div>
                    
                    <div class="question-block" data-id="2.8">
                        <div class="question-row">
                            <span class="question-text"><strong>2.8.</strong> Заполнено, подписано пациентом/представителем и медработником с расшифровкой ФИО.</span>
                            <span class="checkbox-right">
                                <input type="checkbox" id="2.8">
                            </span>
                        </div>
                        <label class="comment-label">Комментарий:</label>
                        <textarea class="comment-area" id="comment_2.8" placeholder="Введите комментарий..."></textarea>
                    </div>
                    
                    <div class="question-block" data-id="2.9">
                        <div class="question-row">
                            <span class="question-text"><strong>2.9.</strong> Строка о предоставлении сведений о состоянии здоровья другому лицу заполнена.</span>
                            <span class="checkbox-right">
                                <input type="checkbox" id="2.9">
                            </span>
                        </div>
                        <label class="comment-label">Комментарий:</label>
                        <textarea class="comment-area" id="comment_2.9" placeholder="Введите комментарий..."></textarea>
                    </div>
                    
                    <div class="question-block" data-id="2.10">
                        <div class="question-row">
                            <span class="question-text"><strong>2.10.</strong> Приложено согласие на пробу с Диаскинтестом (форма по Приказу №89/25).</span>
                            <span class="checkbox-right">
                                <input type="checkbox" id="2.10">
                            </span>
                        </div>
                        <label class="comment-label">Комментарий:</label>
                        <textarea class="comment-area" id="comment_2.10" placeholder="Введите комментарий..."></textarea>
                    </div>
                    
                    <div class="question-block" data-id="2.11">
                        <div class="question-row">
                            <span class="question-text"><strong>2.11.</strong> Проверить четкость печати в бланках согласий, отсутствие обрезки текста.</span>
                            <span class="checkbox-right">
                                <input type="checkbox" id="2.11">
                            </span>
                        </div>
                        <label class="comment-label">Комментарий:</label>
                        <textarea class="comment-area" id="comment_2.11" placeholder="Введите комментарий..."></textarea>
                    </div>

                    <div class="section-comment">
                        <label class="section-comment-label">Общий комментарий к разделу 2:</label>
                        <textarea class="section-comment-area" id="section_comment_2" placeholder="Введите общий комментарий к разделу..."></textarea>
                    </div>
                </div>

                <!-- Раздел 3 -->
                <div class="section">
                    <h2>Раздел 3: Полнота записей в типовых шаблонах (анамнез, осмотр)</h2>
                    
                    <div class="question-block" data-id="3.1">
                        <div class="question-row">
                            <span class="question-text"><strong>3.1.</strong> Указаны жалобы пациента.</span>
                            <span class="checkbox-right">
                                <input type="checkbox" id="3.1">
                            </span>
                        </div>
                        <label class="comment-label">Комментарий:</label>
                        <textarea class="comment-area" id="comment_3.1" placeholder="Введите комментарий..."></textarea>
                    </div>
                    
                    <div class="question-block" data-id="3.2">
                        <div class="question-row">
                            <span class="question-text"><strong>3.2.</strong> Указано направление на консультацию или «самообращение».</span>
                            <span class="checkbox-right">
                                <input type="checkbox" id="3.2">
                            </span>
                        </div>
                        <label class="comment-label">Комментарий:</label>
                        <textarea class="comment-area" id="comment_3.2" placeholder="Введите комментарий..."></textarea>
                    </div>
                    
                    <div class="question-block" data-id="3.3">
                        <div class="question-row">
                            <span class="question-text"><strong>3.3.</strong> Эпидемиологический анамнез (контакты, перенесенный туберкулез).</span>
                            <span class="checkbox-right">
                                <input type="checkbox" id="3.3">
                            </span>
                        </div>
                        <label class="comment-label">Комментарий:</label>
                        <textarea class="comment-area" id="comment_3.3" placeholder="Введите комментарий..."></textarea>
                    </div>
                    
                    <div class="question-block" data-id="3.4">
                        <div class="question-row">
                            <span class="question-text"><strong>3.4.</strong> Сведения о детях в очаге, семейных и производственных контактах.</span>
                            <span class="checkbox-right">
                                <input type="checkbox" id="3.4">
                            </span>
                        </div>
                        <label class="comment-label">Комментарий:</label>
                        <textarea class="comment-area" id="comment_3.4" placeholder="Введите комментарий..."></textarea>
                    </div>
                    
                    <div class="question-block" data-id="3.5">
                        <div class="question-row">
                            <span class="question-text"><strong>3.5.</strong> Сопутствующие заболевания, вредные привычки, пребывание в ФСИН.</span>
                            <span class="checkbox-right">
                                <input type="checkbox" id="3.5">
                            </span>
                        </div>
                        <label class="comment-label">Комментарий:</label>
                        <textarea class="comment-area" id="comment_3.5" placeholder="Введите комментарий..."></textarea>
                    </div>
                    
                    <div class="question-block" data-id="3.6">
                        <div class="question-row">
                            <span class="question-text"><strong>3.6.</strong> Указаны сведения о направляющем специалисте, дате и обстоятельствах выявления патологии.</span>
                            <span class="checkbox-right">
                                <input type="checkbox" id="3.6">
                            </span>
                        </div>
                        <label class="comment-label">Комментарий:</label>
                        <textarea class="comment-area" id="comment_3.6" placeholder="Введите комментарий..."></textarea>
                    </div>
                    
                    <div class="question-block" data-id="3.7">
                        <div class="question-row">
                            <span class="question-text"><strong>3.7.</strong> Заполнен клинико-экспертный анамнез (даже для неработающих).</span>
                            <span class="checkbox-right">
                                <input type="checkbox" id="3.7">
                            </span>
                        </div>
                        <label class="comment-label">Комментарий:</label>
                        <textarea class="comment-area" id="comment_3.7" placeholder="Введите комментарий..."></textarea>
                    </div>
                    
                    <div class="question-block" data-id="3.8">
                        <div class="question-row">
                            <span class="question-text"><strong>3.8.</strong> Указаны перенесенные инфекции, переливания крови, поездки за последние 6 месяцев.</span>
                            <span class="checkbox-right">
                                <input type="checkbox" id="3.8">
                            </span>
                        </div>
                        <label class="comment-label">Комментарий:</label>
                        <textarea class="comment-area" id="comment_3.8" placeholder="Введите комментарий..."></textarea>
                    </div>
                    
                    <div class="question-block" data-id="3.9">
                        <div class="question-row">
                            <span class="question-text"><strong>3.9.</strong> Внесены все результаты: иммунодиагностики, бактериограммы, лабораторных и инструментальных исследований.</span>
                            <span class="checkbox-right">
                                <input type="checkbox" id="3.9">
                            </span>
                        </div>
                        <label class="comment-label">Комментарий:</label>
                        <textarea class="comment-area" id="comment_3.9" placeholder="Введите комментарий..."></textarea>
                    </div>
                    
                    <div class="question-block" data-id="3.10">
                        <div class="question-row">
                            <span class="question-text"><strong>3.10.</strong> Отражены данные объективного осмотра и оценка тяжести состояния.</span>
                            <span class="checkbox-right">
                                <input type="checkbox" id="3.10">
                            </span>
                        </div>
                        <label class="comment-label">Комментарий:</label>
                        <textarea class="comment-area" id="comment_3.10" placeholder="Введите комментарий..."></textarea>
                    </div>
                    
                    <div class="question-block" data-id="3.11">
                        <div class="question-row">
                            <span class="question-text"><strong>3.11.</strong> Имеется обоснование предварительного диагноза.</span>
                            <span class="checkbox-right">
                                <input type="checkbox" id="3.11">
                            </span>
                        </div>
                        <label class="comment-label">Комментарий:</label>
                        <textarea class="comment-area" id="comment_3.11" placeholder="Введите комментарий..."></textarea>
                    </div>
                    
                    <div class="question-block" data-id="3.12">
                        <div class="question-row">
                            <span class="question-text"><strong>3.12.</strong> Указаны сведения о лучевой нагрузке, учтены данные исследований, проведенных в других медицинских организациях, время исследования.</span>
                            <span class="checkbox-right">
                                <input type="checkbox" id="3.12">
                            </span>
                        </div>
                        <label class="comment-label">Комментарий:</label>
                        <textarea class="comment-area" id="comment_3.12" placeholder="Введите комментарий..."></textarea>
                    </div>

                    <div class="section-comment">
                        <label class="section-comment-label">Общий комментарий к разделу 3:</label>
                        <textarea class="section-comment-area" id="section_comment_3" placeholder="Введите общий комментарий к разделу..."></textarea>
                    </div>
                </div>

                <!-- Раздел 4 -->
                <div class="section">
                    <h2>Раздел 4: Оформление диспансерного наблюдения (Эпикриз ВК)</h2>
                    
                    <div class="question-block" data-id="4.1">
                        <div class="question-row">
                            <span class="question-text"><strong>4.1.</strong> Оформлен эпикриз ВК о взятии под диспансерное наблюдение (по установленной форме).</span>
                            <span class="checkbox-right">
                                <input type="checkbox" id="4.1">
                            </span>
                        </div>
                        <label class="comment-label">Комментарий:</label>
                        <textarea class="comment-area" id="comment_4.1" placeholder="Введите комментарий..."></textarea>
                    </div>
                    
                    <div class="question-block" data-id="4.2">
                        <div class="question-row">
                            <span class="question-text"><strong>4.2.</strong> Диагноз в решении ВК оформлен по клинической классификации (форма, локализация, фаза, МБТ, ЛУ, осложнения).</span>
                            <span class="checkbox-right">
                                <input type="checkbox" id="4.2">
                            </span>
                        </div>
                        <label class="comment-label">Комментарий:</label>
                        <textarea class="comment-area" id="comment_4.2" placeholder="Введите комментарий..."></textarea>
                    </div>
                    
                    <div class="question-block" data-id="4.3">
                        <div class="question-row">
                            <span class="question-text"><strong>4.3.</strong> Имеется подробное обоснование диагноза.</span>
                            <span class="checkbox-right">
                                <input type="checkbox" id="4.3">
                            </span>
                        </div>
                        <label class="comment-label">Комментарий:</label>
                        <textarea class="comment-area" id="comment_4.3" placeholder="Введите комментарий..."></textarea>
                    </div>
                    
                    <div class="question-block" data-id="4.4">
                        <div class="question-row">
                            <span class="question-text"><strong>4.4.</strong> Указаны группа диспансерного наблюдения, режим химиотерапии, дата проведения ВК.</span>
                            <span class="checkbox-right">
                                <input type="checkbox" id="4.4">
                            </span>
                        </div>
                        <label class="comment-label">Комментарий:</label>
                        <textarea class="comment-area" id="comment_4.4" placeholder="Введите комментарий..."></textarea>
                    </div>
                    
                    <div class="question-block" data-id="4.5">
                        <div class="question-row">
                            <span class="question-text"><strong>4.5.</strong> Заключительный диагноз установлен в срок не более 14 дней.</span>
                            <span class="checkbox-right">
                                <input type="checkbox" id="4.5">
                            </span>
                        </div>
                        <label class="comment-label">Комментарий:</label>
                        <textarea class="comment-area" id="comment_4.5" placeholder="Введите комментарий..."></textarea>
                    </div>
                    
                    <div class="question-block" data-id="4.6">
                        <div class="question-row">
                            <span class="question-text"><strong>4.6.</strong> Дата ВК совпадает с датой подачи извещений (ф. 058/у и 089/у) и диагнозом в листе уточненных диагнозов.</span>
                            <span class="checkbox-right">
                                <input type="checkbox" id="4.6">
                            </span>
                        </div>
                        <label class="comment-label">Комментарий:</label>
                        <textarea class="comment-area" id="comment_4.6" placeholder="Введите комментарий..."></textarea>
                    </div>
                    
                    <div class="question-block" data-id="4.7">
                        <div class="question-row">
                            <span class="question-text"><strong>4.7.</strong> В протоколе ВК отражена схема лечения или имеется запись о том, что схема лечения будет разработана в стационаре.</span>
                            <span class="checkbox-right">
                                <input type="checkbox" id="4.7">
                            </span>
                        </div>
                        <label class="comment-label">Комментарий:</label>
                        <textarea class="comment-area" id="comment_4.7" placeholder="Введите комментарий..."></textarea>
                    </div>
                    
                    <div class="question-block" data-id="4.9">
                        <div class="question-row">
                            <span class="question-text"><strong>4.9.</strong> В протоколе ВК отражен план ведения (консультация специалистов, лабораторные и инструментальные методы исследования).</span>
                            <span class="checkbox-right">
                                <input type="checkbox" id="4.9">
                            </span>
                        </div>
                        <label class="comment-label">Комментарий:</label>
                        <textarea class="comment-area" id="comment_4.9" placeholder="Введите комментарий..."></textarea>
                    </div>
                    
                    <div class="question-block" data-id="4.10">
                        <div class="question-row">
                            <span class="question-text"><strong>4.10.</strong> Оформлен протокол ВК о постановке на бациллярный учет.</span>
                            <span class="checkbox-right">
                                <input type="checkbox" id="4.10">
                            </span>
                        </div>
                        <label class="comment-label">Комментарий:</label>
                        <textarea class="comment-area" id="comment_4.10" placeholder="Введите комментарий..."></textarea>
                    </div>
                    
                    <div class="question-block" data-id="4.11">
                        <div class="question-row">
                            <span class="question-text"><strong>4.11.</strong> Подана повторно форма 058/у.</span>
                            <span class="checkbox-right">
                                <input type="checkbox" id="4.11">
                            </span>
                        </div>
                        <label class="comment-label">Комментарий:</label>
                        <textarea class="comment-area" id="comment_4.11" placeholder="Введите комментарий..."></textarea>
                    </div>
                    
                    <div class="question-block" data-id="4.12">
                        <div class="question-row">
                            <span class="question-text"><strong>4.12.</strong> Внесены изменения в журнал (ф. № 60-у) и лист уточненных диагнозов.</span>
                            <span class="checkbox-right">
                                <input type="checkbox" id="4.12">
                            </span>
                        </div>
                        <label class="comment-label">Комментарий:</label>
                        <textarea class="comment-area" id="comment_4.12" placeholder="Введите комментарий..."></textarea>
                    </div>
                    
                    <div class="question-block" data-id="4.13">
                        <div class="question-row">
                            <span class="question-text"><strong>4.13.</strong> Указана дата госпитализации. Ведутся ежемесячные записи о лечении в стационаре.</span>
                            <span class="checkbox-right">
                                <input type="checkbox" id="4.13">
                            </span>
                        </div>
                        <label class="comment-label">Комментарий:</label>
                        <textarea class="comment-area" id="comment_4.13" placeholder="Введите комментарий..."></textarea>
                    </div>
                    
                    <div class="question-block" data-id="4.14">
                        <div class="question-row">
                            <span class="question-text"><strong>4.14.</strong> Посещение очага туберкулезной инфекции проведено в срок до 3 суток с момента постановки на учет.</span>
                            <span class="checkbox-right">
                                <input type="checkbox" id="4.14">
                            </span>
                        </div>
                        <label class="comment-label">Комментарий:</label>
                        <textarea class="comment-area" id="comment_4.14" placeholder="Введите комментарий..."></textarea>
                    </div>

                    <div class="section-comment">
                        <label class="section-comment-label">Общий комментарий к разделу 4:</label>
                        <textarea class="section-comment-area" id="section_comment_4" placeholder="Введите общий комментарий к разделу..."></textarea>
                    </div>
                </div>

                <!-- Раздел 5 -->
                <div class="section">
                    <h2>Раздел 5: Этапный эпикриз после стационарного лечения</h2>
                    
                    <div class="question-block" data-id="5.1">
                        <div class="question-row">
                            <span class="question-text"><strong>5.1.</strong> Отражены достигнутые результаты на стационарном этапе.</span>
                            <span class="checkbox-right">
                                <input type="checkbox" id="5.1">
                            </span>
                        </div>
                        <label class="comment-label">Комментарий:</label>
                        <textarea class="comment-area" id="comment_5.1" placeholder="Введите комментарий..."></textarea>
                    </div>
                    
                    <div class="question-block" data-id="5.2">
                        <div class="question-row">
                            <span class="question-text"><strong>5.2.</strong> Имеются рекомендации стационара по дальнейшему ведению лечения.</span>
                            <span class="checkbox-right">
                                <input type="checkbox" id="5.2">
                            </span>
                        </div>
                        <label class="comment-label">Комментарий:</label>
                        <textarea class="comment-area" id="comment_5.2" placeholder="Введите комментарий..."></textarea>
                    </div>
                    
                    <div class="question-block" data-id="5.3">
                        <div class="question-row">
                            <span class="question-text"><strong>5.3.</strong> При наличии данных о непереносимости лекарственных препаратов эти сведения отражены в этапном эпикризе, а также перенесены на оборотную сторону титульного листа формы 025/у.</span>
                            <span class="checkbox-right">
                                <input type="checkbox" id="5.3">
                            </span>
                        </div>
                        <label class="comment-label">Комментарий:</label>
                        <textarea class="comment-area" id="comment_5.3" placeholder="Введите комментарий..."></textarea>
                    </div>
                    
                    <div class="question-block" data-id="5.4">
                        <div class="question-row">
                            <span class="question-text"><strong>5.4.</strong> Указаны причины выписки из стационара.</span>
                            <span class="checkbox-right">
                                <input type="checkbox" id="5.4">
                            </span>
                        </div>
                        <label class="comment-label">Комментарий:</label>
                        <textarea class="comment-area" id="comment_5.4" placeholder="Введите комментарий..."></textarea>
                    </div>
                    
                    <div class="question-block" data-id="5.5">
                        <div class="question-row">
                            <span class="question-text"><strong>5.5.</strong> Отражено, была ли консультация хирурга и ее результаты.</span>
                            <span class="checkbox-right">
                                <input type="checkbox" id="5.5">
                            </span>
                        </div>
                        <label class="comment-label">Комментарий:</label>
                        <textarea class="comment-area" id="comment_5.5" placeholder="Введите комментарий..."></textarea>
                    </div>
                    
                    <div class="question-block" data-id="5.6">
                        <div class="question-row">
                            <span class="question-text"><strong>5.6.</strong> Составлен подробный план ведения и лечения пациента.</span>
                            <span class="checkbox-right">
                                <input type="checkbox" id="5.6">
                            </span>
                        </div>
                        <label class="comment-label">Комментарий:</label>
                        <textarea class="comment-area" id="comment_5.6" placeholder="Введите комментарий..."></textarea>
                    </div>

                    <div class="section-comment">
                        <label class="section-comment-label">Общий комментарий к разделу 5:</label>
                        <textarea class="section-comment-area" id="section_comment_5" placeholder="Введите общий комментарий к разделу..."></textarea>
                    </div>
                </div>

                <!-- Раздел 6 -->
                <div class="section">
                    <h2>Раздел 6: Ведение дневниковых записей на амбулаторном этапе</h2>
                    
                    <div class="question-block" data-id="6.1">
                        <div class="question-row">
                            <span class="question-text"><strong>6.1.</strong> По окончании каждого этапа своевременно проведено ВК.</span>
                            <span class="checkbox-right">
                                <input type="checkbox" id="6.1">
                            </span>
                        </div>
                        <label class="comment-label">Комментарий:</label>
                        <textarea class="comment-area" id="comment_6.1" placeholder="Введите комментарий..."></textarea>
                    </div>
                    
                    <div class="question-block" data-id="6.2">
                        <div class="question-row">
                            <span class="question-text"><strong>6.2.</strong> Записи ведутся не реже 1 раза в 7 дней (или чаще по необходимости).</span>
                            <span class="checkbox-right">
                                <input type="checkbox" id="6.2">
                            </span>
                        </div>
                        <label class="comment-label">Комментарий:</label>
                        <textarea class="comment-area" id="comment_6.2" placeholder="Введите комментарий..."></textarea>
                    </div>
                    
                    <div class="question-block" data-id="6.3">
                        <div class="question-row">
                            <span class="question-text"><strong>6.3.</strong> Указаны жалобы (детализировано).</span>
                            <span class="checkbox-right">
                                <input type="checkbox" id="6.3">
                            </span>
                        </div>
                        <label class="comment-label">Комментарий:</label>
                        <textarea class="comment-area" id="comment_6.3" placeholder="Введите комментарий..."></textarea>
                    </div>
                    
                    <div class="question-block" data-id="6.4">
                        <div class="question-row">
                            <span class="question-text"><strong>6.4.</strong> Отражена полнота объективного осмотра (АД, ЧСС, ЧДД).</span>
                            <span class="checkbox-right">
                                <input type="checkbox" id="6.4">
                            </span>
                        </div>
                        <label class="comment-label">Комментарий:</label>
                        <textarea class="comment-area" id="comment_6.4" placeholder="Введите комментарий..."></textarea>
                    </div>
                    
                    <div class="question-block" data-id="6.5">
                        <div class="question-row">
                            <span class="question-text"><strong>6.5.</strong> Отражены результаты и интерпретация предыдущих лабораторных и инструментальных исследований.</span>
                            <span class="checkbox-right">
                                <input type="checkbox" id="6.5">
                            </span>
                        </div>
                        <label class="comment-label">Комментарий:</label>
                        <textarea class="comment-area" id="comment_6.5" placeholder="Введите комментарий..."></textarea>
                    </div>
                    
                    <div class="question-block" data-id="6.6">
                        <div class="question-row">
                            <span class="question-text"><strong>6.6.</strong> Указано, что пациент ознакомлен с результатами обследования.</span>
                            <span class="checkbox-right">
                                <input type="checkbox" id="6.6">
                            </span>
                        </div>
                        <label class="comment-label">Комментарий:</label>
                        <textarea class="comment-area" id="comment_6.6" placeholder="Введите комментарий..."></textarea>
                    </div>
                    
                    <div class="question-block" data-id="6.7">
                        <div class="question-row">
                            <span class="question-text"><strong>6.7.</strong> Указан развернутый клинический диагноз (без сокращений).</span>
                            <span class="checkbox-right">
                                <input type="checkbox" id="6.7">
                            </span>
                        </div>
                        <label class="comment-label">Комментарий:</label>
                        <textarea class="comment-area" id="comment_6.7" placeholder="Введите комментарий..."></textarea>
                    </div>
                    
                    <div class="question-block" data-id="6.8">
                        <div class="question-row">
                            <span class="question-text"><strong>6.8.</strong> Назначены дополнительные методы исследований в соответствии с клиническими рекомендациями.</span>
                            <span class="checkbox-right">
                                <input type="checkbox" id="6.8">
                            </span>
                        </div>
                        <label class="comment-label">Комментарий:</label>
                        <textarea class="comment-area" id="comment_6.8" placeholder="Введите комментарий..."></textarea>
                    </div>
                    
                    <div class="question-block" data-id="6.9">
                        <div class="question-row">
                            <span class="question-text"><strong>6.9.</strong> Соблюдена кратность направлений к другим специалистам.</span>
                            <span class="checkbox-right">
                                <input type="checkbox" id="6.9">
                            </span>
                        </div>
                        <label class="comment-label">Комментарий:</label>
                        <textarea class="comment-area" id="comment_6.9" placeholder="Введите комментарий..."></textarea>
                    </div>
                    
                    <div class="question-block" data-id="6.10">
                        <div class="question-row">
                            <span class="question-text"><strong>6.10.</strong> При назначении ЛС указаны: доза, способ введения, кратность, время приема, связь с пищей, количество выданного.</span>
                            <span class="checkbox-right">
                                <input type="checkbox" id="6.10">
                            </span>
                        </div>
                        <label class="comment-label">Комментарий:</label>
                        <textarea class="comment-area" id="comment_6.10" placeholder="Введите комментарий..."></textarea>
                    </div>
                    
                    <div class="question-block" data-id="6.11">
                        <div class="question-row">
                            <span class="question-text"><strong>6.11.</strong> Указана дата следующей явки.</span>
                            <span class="checkbox-right">
                                <input type="checkbox" id="6.11">
                            </span>
                        </div>
                        <label class="comment-label">Комментарий:</label>
                        <textarea class="comment-area" id="comment_6.11" placeholder="Введите комментарий..."></textarea>
                    </div>
                    
                    <div class="question-block" data-id="6.12">
                        <div class="question-row">
                            <span class="question-text"><strong>6.12.</strong> Запись подписана лечащим врачом с расшифровкой подписи.</span>
                            <span class="checkbox-right">
                                <input type="checkbox" id="6.12">
                            </span>
                        </div>
                        <label class="comment-label">Комментарий:</label>
                        <textarea class="comment-area" id="comment_6.12" placeholder="Введите комментарий..."></textarea>
                    </div>
                    
                    <div class="question-block" data-id="6.13">
                        <div class="question-row">
                            <span class="question-text"><strong>6.13.</strong> Записи в карте полностью отражают клиническое мышление врача; обоснованность назначения любых исследований не вызывает вопросов, не требует уточнений.</span>
                            <span class="checkbox-right">
                                <input type="checkbox" id="6.13">
                            </span>
                        </div>
                        <label class="comment-label">Комментарий:</label>
                        <textarea class="comment-area" id="comment_6.13" placeholder="Введите комментарий..."></textarea>
                    </div>

                    <div class="section-comment">
                        <label class="section-comment-label">Общий комментарий к разделу 6:</label>
                        <textarea class="section-comment-area" id="section_comment_6" placeholder="Введите общий комментарий к разделу..."></textarea>
                    </div>
                </div>

                <!-- Раздел 7 -->
                <div class="section">
                    <h2>Раздел 7: Наличие протоколов ВК (обязательные случаи)</h2>
                    
                    <div class="question-block" data-id="7.1">
                        <div class="question-row">
                            <span class="question-text"><strong>7.1.</strong> Взятие/снятие с диспансерного наблюдения.</span>
                            <span class="checkbox-right">
                                <input type="checkbox" id="7.1">
                            </span>
                        </div>
                        <label class="comment-label">Комментарий:</label>
                        <textarea class="comment-area" id="comment_7.1" placeholder="Введите комментарий..."></textarea>
                    </div>
                    
                    <div class="question-block" data-id="7.2">
                        <div class="question-row">
                            <span class="question-text"><strong>7.2.</strong> Перевод в другую группу диспансерного наблюдения.</span>
                            <span class="checkbox-right">
                                <input type="checkbox" id="7.2">
                            </span>
                        </div>
                        <label class="comment-label">Комментарий:</label>
                        <textarea class="comment-area" id="comment_7.2" placeholder="Введите комментарий..."></textarea>
                    </div>
                    
                    <div class="question-block" data-id="7.3">
                        <div class="question-row">
                            <span class="question-text"><strong>7.3.</strong> Окончание интенсивной фазы и перевод на фазу продолжения.</span>
                            <span class="checkbox-right">
                                <input type="checkbox" id="7.3">
                            </span>
                        </div>
                        <label class="comment-label">Комментарий:</label>
                        <textarea class="comment-area" id="comment_7.3" placeholder="Введите комментарий..."></textarea>
                    </div>
                    
                    <div class="question-block" data-id="7.4">
                        <div class="question-row">
                            <span class="question-text"><strong>7.4.</strong> Продление фазы лечения сверх установленного срока.</span>
                            <span class="checkbox-right">
                                <input type="checkbox" id="7.4">
                            </span>
                        </div>
                        <label class="comment-label">Комментарий:</label>
                        <textarea class="comment-area" id="comment_7.4" placeholder="Введите комментарий..."></textarea>
                    </div>
                    
                    <div class="question-block" data-id="7.5">
                        <div class="question-row">
                            <span class="question-text"><strong>7.5.</strong> Изменение схемы лечения (замена препаратов, НЯ, отсутствие в аптеке).</span>
                            <span class="checkbox-right">
                                <input type="checkbox" id="7.5">
                            </span>
                        </div>
                        <label class="comment-label">Комментарий:</label>
                        <textarea class="comment-area" id="comment_7.5" placeholder="Введите комментарий..."></textarea>
                    </div>
                    
                    <div class="question-block" data-id="7.6">
                        <div class="question-row">
                            <span class="question-text"><strong>7.6.</strong> Появление полости распада или бактериовыделения (изменение в листе диагнозов).</span>
                            <span class="checkbox-right">
                                <input type="checkbox" id="7.6">
                            </span>
                        </div>
                        <label class="comment-label">Комментарий:</label>
                        <textarea class="comment-area" id="comment_7.6" placeholder="Введите комментарий..."></textarea>
                    </div>
                    
                    <div class="question-block" data-id="7.7">
                        <div class="question-row">
                            <span class="question-text"><strong>7.7.</strong> Выписка из стационара с назначением дорогостоящих или 5 и более препаратов.</span>
                            <span class="checkbox-right">
                                <input type="checkbox" id="7.7">
                            </span>
                        </div>
                        <label class="comment-label">Комментарий:</label>
                        <textarea class="comment-area" id="comment_7.7" placeholder="Введите комментарий..."></textarea>
                    </div>
                    
                    <div class="question-block" data-id="7.8">
                        <div class="question-row">
                            <span class="question-text"><strong>7.8.</strong> Назначение профилактического лечения группам риска.</span>
                            <span class="checkbox-right">
                                <input type="checkbox" id="7.8">
                            </span>
                        </div>
                        <label class="comment-label">Комментарий:</label>
                        <textarea class="comment-area" id="comment_7.8" placeholder="Введите комментарий..."></textarea>
                    </div>
                    
                    <div class="question-block" data-id="7.9">
                        <div class="question-row">
                            <span class="question-text"><strong>7.9.</strong> Направление на МСЭ (оформление ф. 088/у).</span>
                            <span class="checkbox-right">
                                <input type="checkbox" id="7.9">
                            </span>
                        </div>
                        <label class="comment-label">Комментарий:</label>
                        <textarea class="comment-area" id="comment_7.9" placeholder="Введите комментарий..."></textarea>
                    </div>
                    
                    <div class="question-block" data-id="7.10">
                        <div class="question-row">
                            <span class="question-text"><strong>7.10.</strong> Выдача/продление листка нетрудоспособности свыше 15 дней.</span>
                            <span class="checkbox-right">
                                <input type="checkbox" id="7.10">
                            </span>
                        </div>
                        <label class="comment-label">Комментарий:</label>
                        <textarea class="comment-area" id="comment_7.10" placeholder="Введите комментарий..."></textarea>
                    </div>
                    
                    <div class="question-block" data-id="7.11">
                        <div class="question-row">
                            <span class="question-text"><strong>7.11.</strong> Допуск к труду/учебе, оформление академического отпуска.</span>
                            <span class="checkbox-right">
                                <input type="checkbox" id="7.11">
                            </span>
                        </div>
                        <label class="comment-label">Комментарий:</label>
                        <textarea class="comment-area" id="comment_7.11" placeholder="Введите комментарий..."></textarea>
                    </div>
                    
                    <div class="question-block" data-id="7.12">
                        <div class="question-row">
                            <span class="question-text"><strong>7.12.</strong> Разбор жалоб и случаев смерти.</span>
                            <span class="checkbox-right">
                                <input type="checkbox" id="7.12">
                            </span>
                        </div>
                        <label class="comment-label">Комментарий:</label>
                        <textarea class="comment-area" id="comment_7.12" placeholder="Введите комментарий..."></textarea>
                    </div>
                    
                    <div class="question-block" data-id="7.13">
                        <div class="question-row">
                            <span class="question-text"><strong>7.13.</strong> Подписи не менее 3-х членов ВК с указанием номера и даты.</span>
                            <span class="checkbox-right">
                                <input type="checkbox" id="7.13">
                            </span>
                        </div>
                        <label class="comment-label">Комментарий:</label>
                        <textarea class="comment-area" id="comment_7.13" placeholder="Введите комментарий..."></textarea>
                    </div>

                    <div class="section-comment">
                        <label class="section-comment-label">Общий комментарий к разделу 7:</label>
                        <textarea class="section-comment-area" id="section_comment_7" placeholder="Введите общий комментарий к разделу..."></textarea>
                    </div>
                </div>

                <!-- Раздел 8 -->
                <div class="section">
                    <h2>Раздел 8: Виды эпикризов (должны присутствовать)</h2>
                    
                    <div class="question-block" data-id="8.1">
                        <div class="question-row">
                            <span class="question-text"><strong>8.1.</strong> Эпикриз при продолжении лечения после стационара.</span>
                            <span class="checkbox-right">
                                <input type="checkbox" id="8.1">
                            </span>
                        </div>
                        <label class="comment-label">Комментарий:</label>
                        <textarea class="comment-area" id="comment_8.1" placeholder="Введите комментарий..."></textarea>
                    </div>
                    
                    <div class="question-block" data-id="8.2">
                        <div class="question-row">
                            <span class="question-text"><strong>8.2.</strong> Этапный эпикриз при переводе из интенсивной фазы в фазу продолжения.</span>
                            <span class="checkbox-right">
                                <input type="checkbox" id="8.2">
                            </span>
                        </div>
                        <label class="comment-label">Комментарий:</label>
                        <textarea class="comment-area" id="comment_8.2" placeholder="Введите комментарий..."></textarea>
                    </div>
                    
                    <div class="question-block" data-id="8.3">
                        <div class="question-row">
                            <span class="question-text"><strong>8.3.</strong> Годовой эпикриз.</span>
                            <span class="checkbox-right">
                                <input type="checkbox" id="8.3">
                            </span>
                        </div>
                        <label class="comment-label">Комментарий:</label>
                        <textarea class="comment-area" id="comment_8.3" placeholder="Введите комментарий..."></textarea>
                    </div>
                    
                    <div class="question-block" data-id="8.4">
                        <div class="question-row">
                            <span class="question-text"><strong>8.4.</strong> Эпикриз передачи пациента другому врачу на период отпуска.</span>
                            <span class="checkbox-right">
                                <input type="checkbox" id="8.4">
                            </span>
                        </div>
                        <label class="comment-label">Комментарий:</label>
                        <textarea class="comment-area" id="comment_8.4" placeholder="Введите комментарий..."></textarea>
                    </div>

                    <div class="section-comment">
                        <label class="section-comment-label">Общий комментарий к разделу 8:</label>
                        <textarea class="section-comment-area" id="section_comment_8" placeholder="Введите общий комментарий к разделу..."></textarea>
                    </div>
                </div>

                <!-- Раздел 9 -->
                <div class="section">
                    <h2>Раздел 9: Организация работы в ЕМИАС</h2>
                    
                    <div class="question-block" data-id="9.1">
                        <div class="question-row">
                            <span class="question-text"><strong>9.1.</strong> Сведения о каждом посещении вносятся в ЕМИАС в день визита.</span>
                            <span class="checkbox-right">
                                <input type="checkbox" id="9.1">
                            </span>
                        </div>
                        <label class="comment-label">Комментарий:</label>
                        <textarea class="comment-area" id="comment_9.1" placeholder="Введите комментарий..."></textarea>
                    </div>
                    
                    <div class="question-block" data-id="9.2">
                        <div class="question-row">
                            <span class="question-text"><strong>9.2.</strong> Каждое посещение вносится как первичное, вид услуги — «ОМС».</span>
                            <span class="checkbox-right">
                                <input type="checkbox" id="9.2">
                            </span>
                        </div>
                        <label class="comment-label">Комментарий:</label>
                        <textarea class="comment-area" id="comment_9.2" placeholder="Введите комментарий..."></textarea>
                    </div>
                    
                    <div class="question-block" data-id="9.3">
                        <div class="question-row">
                            <span class="question-text"><strong>9.3.</strong> Дата в ТАП и дата дневниковой записи строго совпадают.</span>
                            <span class="checkbox-right">
                                <input type="checkbox" id="9.3">
                            </span>
                        </div>
                        <label class="comment-label">Комментарий:</label>
                        <textarea class="comment-area" id="comment_9.3" placeholder="Введите комментарий..."></textarea>
                    </div>
                    
                    <div class="question-block" data-id="9.4">
                        <div class="question-row">
                            <span class="question-text"><strong>9.4.</strong> Клинический диагноз в ТАП и дневниковой записи совпадает.</span>
                            <span class="checkbox-right">
                                <input type="checkbox" id="9.4">
                            </span>
                        </div>
                        <label class="comment-label">Комментарий:</label>
                        <textarea class="comment-area" id="comment_9.4" placeholder="Введите комментарий..."></textarea>
                    </div>
                    
                    <div class="question-block" data-id="9.5">
                        <div class="question-row">
                            <span class="question-text"><strong>9.5.</strong> В один день не оформляются посещения врача-фтизиатра двух разных филиалов/КДО.</span>
                            <span class="checkbox-right">
                                <input type="checkbox" id="9.5">
                            </span>
                        </div>
                        <label class="comment-label">Комментарий:</label>
                        <textarea class="comment-area" id="comment_9.5" placeholder="Введите комментарий..."></textarea>
                    </div>
                    
                    <div class="question-block" data-id="9.6">
                        <div class="question-row">
                            <span class="question-text"><strong>9.6.</strong> Расписание приемов в ЕМИАС соответствует фактическому.</span>
                            <span class="checkbox-right">
                                <input type="checkbox" id="9.6">
                            </span>
                        </div>
                        <label class="comment-label">Комментарий:</label>
                        <textarea class="comment-area" id="comment_9.6" placeholder="Введите комментарий..."></textarea>
                    </div>
                    
                    <div class="question-block" data-id="9.7">
                        <div class="question-row">
                            <span class="question-text"><strong>9.7.</strong> Телемедицинские консультации (видеоконтроль) оформляются как первичное посещение, вид услуги — «ОМС».</span>
                            <span class="checkbox-right">
                                <input type="checkbox" id="9.7">
                            </span>
                        </div>
                        <label class="comment-label">Комментарий:</label>
                        <textarea class="comment-area" id="comment_9.7" placeholder="Введите комментарий..."></textarea>
                    </div>

                    <div class="section-comment">
                        <label class="section-comment-label">Общий комментарий к разделу 9:</label>
                        <textarea class="section-comment-area" id="section_comment_9" placeholder="Введите общий комментарий к разделу..."></textarea>
                    </div>
                </div>
            </form>

            <div class="bottom-controls">
                <button type="button" class="save-excel-btn" id="saveExcelBtn">Сохранить в Excel</button>
            </div>
        </div>
    </div>

    <script>
        (function() {
            const form = document.getElementById('checklistForm');
            const statusMsg = document.getElementById('statusMessage');
            const clearBtn = document.getElementById('clearBtn');
            const saveBtn = document.getElementById('saveExcelBtn');
            const progressFill = document.getElementById('progressFill');
            const progressPercent = document.getElementById('progressPercent');
            const completedSpan = document.getElementById('completedCount');
            const totalSpan = document.getElementById('totalCount');
            const currentDateDisplay = document.getElementById('currentDateDisplay');
            const patientId = document.getElementById('patientId');
            const checkDate = document.getElementById('checkDate');

            // Установить общее количество пунктов (67)
            totalSpan.textContent = '67';

            function setCurrentDate() {
                const today = new Date().toISOString().split('T')[0];
                if (!checkDate.value) checkDate.value = today;
                updateDateDisplay();
            }

            function updateDateDisplay() {
                if (checkDate.value) {
                    const d = new Date(checkDate.value);
                    currentDateDisplay.textContent = d.toLocaleDateString('ru-RU');
                } else {
                    currentDateDisplay.textContent = 'дата не выбрана';
                }
            }

            function updateProgressAndColors() {
                const checkboxes = form.querySelectorAll('input[type="checkbox"]');
                let checkedCount = 0;
                checkboxes.forEach(cb => {
                    if (cb.checked) checkedCount++;
                });
                const total = checkboxes.length;
                const percent = total ? Math.round((checkedCount / total) * 100) : 0;
                progressFill.style.width = percent + '%';
                progressPercent.textContent = percent + '%';
                completedSpan.textContent = checkedCount;

                checkboxes.forEach(cb => {
                    const block = cb.closest('.question-block');
                    if (!block) return;
                    const commentArea = block.querySelector('.comment-area');
                    const hasComment = commentArea && commentArea.value.trim() !== '';
                    
                    block.classList.remove('checkbox-green', 'checkbox-red');
                    
                    if (hasComment) {
                        block.classList.add('checkbox-red');
                    } else if (cb.checked) {
                        block.classList.add('checkbox-green');
                    }
                });
            }

            function attachListeners() {
                document.querySelectorAll('.question-block').forEach(block => {
                    block.addEventListener('click', function(e) {
                        if (e.target.tagName === 'TEXTAREA' || e.target.tagName === 'INPUT') return;
                        const cb = this.querySelector('input[type="checkbox"]');
                        if (cb) {
                            cb.checked = !cb.checked;
                            updateProgressAndColors();
                            saveAllData();
                        }
                    });
                });

                document.querySelectorAll('.comment-area').forEach(area => {
                    area.addEventListener('input', function() {
                        updateProgressAndColors();
                        saveAllData();
                    });
                });

                document.querySelectorAll('.section-comment-area').forEach(area => {
                    area.addEventListener('input', saveAllData);
                });

                patientId.addEventListener('input', saveAllData);
                checkDate.addEventListener('change', function() {
                    updateDateDisplay();
                    saveAllData();
                });

                form.addEventListener('change', function(e) {
                    if (e.target.type === 'checkbox') {
                        updateProgressAndColors();
                        saveAllData();
                    }
                });
            }

            function saveAllData() {
                const data = {
                    checkboxes: {},
                    comments: {},
                    sectionComments: {},
                    patientId: patientId.value,
                    checkDate: checkDate.value
                };

                form.querySelectorAll('input[type="checkbox"]').forEach(cb => {
                    data.checkboxes[cb.id] = cb.checked;
                });

                document.querySelectorAll('.comment-area').forEach(area => {
                    const id = area.id.replace('comment_', '');
                    data.comments[id] = area.value;
                });

                document.querySelectorAll('.section-comment-area').forEach(area => {
                    const sectionId = area.id.replace('section_comment_', '');
                    data.sectionComments[sectionId] = area.value;
                });

                localStorage.setItem('checklistFull', JSON.stringify(data));
                showStatus('Автосохранение', 'success');
            }

            function loadSaved() {
                const saved = localStorage.getItem('checklistFull');
                if (!saved) return;

                try {
                    const data = JSON.parse(saved);

                    for (let [id, val] of Object.entries(data.checkboxes || {})) {
                        const cb = document.getElementById(id);
                        if (cb) cb.checked = val;
                    }

                    for (let [id, val] of Object.entries(data.comments || {})) {
                        const area = document.getElementById('comment_' + id);
                        if (area) area.value = val;
                    }

                    for (let [secId, val] of Object.entries(data.sectionComments || {})) {
                        const area = document.getElementById('section_comment_' + secId);
                        if (area) area.value = val;
                    }

                    if (data.patientId) patientId.value = data.patientId;
                    if (data.checkDate) {
                        checkDate.value = data.checkDate;
                        updateDateDisplay();
                    }

                    updateProgressAndColors();
                } catch (e) {
                    console.warn('Ошибка загрузки', e);
                }
            }

            function clearAll() {
                if (!confirm('Очистить все отметки и комментарии?')) return;

                form.querySelectorAll('input[type="checkbox"]').forEach(cb => cb.checked = false);
                form.querySelectorAll('.comment-area').forEach(a => a.value = '');
                document.querySelectorAll('.section-comment-area').forEach(a => a.value = '');
                patientId.value = '';
                setCurrentDate();

                updateProgressAndColors();
                saveAllData();
                showStatus('Форма очищена', 'success');
            }

            function exportToExcel() {
                try {
                    const rows = [
                        ['Чек-лист медицинской карты (форма 025/у)'],
                        ['ID/№ карты:', patientId.value || '—'],
                        ['Дата проверки:', checkDate.value || '—'],
                        []
                    ];

                    rows.push(['Раздел', 'Пункт', 'Статус', 'Комментарий']);

                    const sections = form.querySelectorAll('.section');
                    sections.forEach(section => {
                        const title = section.querySelector('h2')?.textContent || '';
                        rows.push([title, '', '', '']);

                        const blocks = section.querySelectorAll('.question-block');
                        blocks.forEach(block => {
                            const cb = block.querySelector('input[type="checkbox"]');
                            const labelSpan = block.querySelector('.question-text');
                            const comment = block.querySelector('.comment-area')?.value || '';

                            const status = cb?.checked ? '✅' : '⬜';
                            const text = labelSpan ? labelSpan.innerText.replace(/\n/g, ' ').trim() : '';

                            rows.push(['', text, status, comment]);
                        });

                        const secComment = section.querySelector('.section-comment-area');
                        if (secComment && secComment.value.trim()) {
                            rows.push(['', 'Общий комментарий:', '', secComment.value]);
                        }
                        rows.push([]);
                    });

                    const wb = XLSX.utils.book_new();
                    const ws = XLSX.utils.aoa_to_sheet(rows);
                    ws['!cols'] = [{wch:20}, {wch:60}, {wch:10}, {wch:40}];
                    XLSX.utils.book_append_sheet(wb, ws, 'Карта');
                    const fileName = `checklist_${patientId.value || 'card'}_${checkDate.value || 'today'}.xlsx`;
                    XLSX.writeFile(wb, fileName);
                    showStatus('Excel сохранён', 'success');
                } catch (err) {
                    alert('Ошибка при сохранении Excel');
                }
            }

            function showStatus(msg, type) {
                statusMsg.textContent = msg;
                statusMsg.style.background = type === 'success' ? '#e3f7e3' : '#fde8e8';
                setTimeout(() => {
                    statusMsg.innerHTML = 'Готов к работе • Автосохранение каждые 10 секунд';
                    statusMsg.style.background = '#e8f4fd';
                }, 2500);
            }

            setCurrentDate();
            loadSaved();
            attachListeners();
            updateProgressAndColors();

            setInterval(saveAllData, 10000);

            clearBtn.addEventListener('click', clearAll);
            saveBtn.addEventListener('click', exportToExcel);
        })();
    </script>
</body>
</html>
